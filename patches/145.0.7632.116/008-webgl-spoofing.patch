From e8034e6c007418a0eea30bb8ad1ec9ef7dca3457 Mon Sep 17 00:00:00 2001
From: ENbanned <nik.skvortsov2007@gmail.com>
Date: Thu, 26 Feb 2026 10:59:26 +0000
Subject: [PATCH 08/11] 008-webgl-spoofing

---
 .../renderer_host/render_process_host_impl.cc      |  2 ++
 third_party/blink/common/switches.cc               |  2 ++
 third_party/blink/public/common/switches.h         |  2 ++
 .../modules/webgl/webgl_rendering_context_base.cc  | 14 ++++++++++++++
 4 files changed, 20 insertions(+)

diff --git a/content/browser/renderer_host/render_process_host_impl.cc b/content/browser/renderer_host/render_process_host_impl.cc
index f256c23eee52e..eb6e7fbb13bd0 100644
--- a/content/browser/renderer_host/render_process_host_impl.cc
+++ b/content/browser/renderer_host/render_process_host_impl.cc
@@ -3804,6 +3804,8 @@ void RenderProcessHostImpl::PropagateBrowserCommandLineToRenderer(
       blink::switches::kAspectColorDepth,
       blink::switches::kAspectDevicePixelRatio,
       blink::switches::kAspectCanvasNoiseSeed,
+      blink::switches::kAspectWebglVendor,
+      blink::switches::kAspectWebglRenderer,
       // Please keep these in alphabetical order. Compositor switches here
       // should also be added to
       // chrome/browser/ash/login/chrome_restart_request.cc.
diff --git a/third_party/blink/common/switches.cc b/third_party/blink/common/switches.cc
index 55138a48d1e95..6fe14b04410bd 100644
--- a/third_party/blink/common/switches.cc
+++ b/third_party/blink/common/switches.cc
@@ -173,6 +173,8 @@ const char kAspectUaPlatform[] = "aspect-ua-platform";
 const char kAspectUaPlatformVersion[] = "aspect-ua-platform-version";
 const char kAspectUaArch[] = "aspect-ua-arch";
 const char kAspectCanvasNoiseSeed[] = "aspect-canvas-noise-seed";
+const char kAspectWebglVendor[] = "aspect-webgl-vendor";
+const char kAspectWebglRenderer[] = "aspect-webgl-renderer";
 
 }  // namespace switches
 }  // namespace blink
diff --git a/third_party/blink/public/common/switches.h b/third_party/blink/public/common/switches.h
index bac5ce57b94fb..3cf962472366b 100644
--- a/third_party/blink/public/common/switches.h
+++ b/third_party/blink/public/common/switches.h
@@ -69,6 +69,8 @@ BLINK_COMMON_EXPORT extern const char kAspectUaPlatform[];
 BLINK_COMMON_EXPORT extern const char kAspectUaPlatformVersion[];
 BLINK_COMMON_EXPORT extern const char kAspectUaArch[];
 BLINK_COMMON_EXPORT extern const char kAspectCanvasNoiseSeed[];
+BLINK_COMMON_EXPORT extern const char kAspectWebglVendor[];
+BLINK_COMMON_EXPORT extern const char kAspectWebglRenderer[];
 }  // namespace switches
 }  // namespace blink
 
diff --git a/third_party/blink/renderer/modules/webgl/webgl_rendering_context_base.cc b/third_party/blink/renderer/modules/webgl/webgl_rendering_context_base.cc
index 72a80ba576711..defab6d35da9d 100644
--- a/third_party/blink/renderer/modules/webgl/webgl_rendering_context_base.cc
+++ b/third_party/blink/renderer/modules/webgl/webgl_rendering_context_base.cc
@@ -110,6 +110,8 @@
 #include "third_party/blink/renderer/modules/webgl/webgl_context_attribute_helpers.h"
 #include "third_party/blink/renderer/modules/webgl/webgl_context_event.h"
 #include "third_party/blink/renderer/modules/webgl/webgl_debug_renderer_info.h"
+#include "base/command_line.h"
+#include "third_party/blink/public/common/switches.h"
 #include "third_party/blink/renderer/modules/webgl/webgl_debug_shaders.h"
 #include "third_party/blink/renderer/modules/webgl/webgl_depth_texture.h"
 #include "third_party/blink/renderer/modules/webgl/webgl_draw_buffers.h"
@@ -3976,6 +3978,12 @@ ScriptValue WebGLRenderingContextBase::getParameter(ScriptState* script_state,
       return ScriptValue::CreateNull(script_state->GetIsolate());
     case WebGLDebugRendererInfo::kUnmaskedRendererWebgl:
       if (ExtensionEnabled(kWebGLDebugRendererInfoName)) {
+        {
+          const auto& cmd = *base::CommandLine::ForCurrentProcess();
+          if (cmd.HasSwitch(blink::switches::kAspectWebglRenderer))
+            return WebGLAny(script_state, String(cmd.GetSwitchValueASCII(
+                blink::switches::kAspectWebglRenderer)));
+        }
         return WebGLAny(script_state,
                         String(ContextGL()->GetString(GL_RENDERER)));
       }
@@ -3985,6 +3993,12 @@ ScriptValue WebGLRenderingContextBase::getParameter(ScriptState* script_state,
       return ScriptValue::CreateNull(script_state->GetIsolate());
     case WebGLDebugRendererInfo::kUnmaskedVendorWebgl:
       if (ExtensionEnabled(kWebGLDebugRendererInfoName)) {
+        {
+          const auto& cmd = *base::CommandLine::ForCurrentProcess();
+          if (cmd.HasSwitch(blink::switches::kAspectWebglVendor))
+            return WebGLAny(script_state, String(cmd.GetSwitchValueASCII(
+                blink::switches::kAspectWebglVendor)));
+        }
         return WebGLAny(script_state,
                         String(ContextGL()->GetString(GL_VENDOR)));
       }
-- 
2.39.5

