From 485ee256365928bd364cb4e0e6e6fb3b7a49b4c0 Mon Sep 17 00:00:00 2001
From: ENbanned <nik.skvortsov2007@gmail.com>
Date: Fri, 27 Feb 2026 21:01:01 +0000
Subject: [PATCH 02/10] 002-navigator-spoofing

Navigator fingerprint spoofing:
- webdriver always returns false
- platform override via --aspect-platform (main frame + workers)
- hardwareConcurrency override via --aspect-hardware-concurrency
- deviceMemory override via --aspect-device-memory (validated against allowed set)
---
 .../core/execution_context/navigator_base.cc  |  6 ++++++
 .../blink/renderer/core/frame/navigator.cc    |  7 +------
 .../frame/navigator_concurrent_hardware.cc    | 12 +++++++++++
 .../core/frame/navigator_device_memory.cc     | 20 +++++++++++++++++++
 .../blink/renderer/core/frame/navigator_id.cc |  6 ++++++
 5 files changed, 45 insertions(+), 6 deletions(-)

diff --git a/third_party/blink/renderer/core/execution_context/navigator_base.cc b/third_party/blink/renderer/core/execution_context/navigator_base.cc
index d08b96066d76f..089c02d0339b2 100644
--- a/third_party/blink/renderer/core/execution_context/navigator_base.cc
+++ b/third_party/blink/renderer/core/execution_context/navigator_base.cc
@@ -4,6 +4,9 @@
 
 #include "third_party/blink/renderer/core/execution_context/navigator_base.h"
 
+#include "base/command_line.h"
+#include "third_party/blink/public/common/switches.h"
+
 #include "base/feature_list.h"
 #include "build/build_config.h"
 #include "third_party/blink/public/common/features.h"
@@ -51,6 +54,9 @@ String NavigatorBase::userAgent() const {
 }
 
 String NavigatorBase::platform() const {
+  const auto& cmd = *base::CommandLine::ForCurrentProcess();
+  if (cmd.HasSwitch(blink::switches::kAspectPlatform))
+    return String(cmd.GetSwitchValueASCII(blink::switches::kAspectPlatform));
 #if BUILDFLAG(IS_ANDROID)
   ExecutionContext* execution_context = GetExecutionContext();
 
diff --git a/third_party/blink/renderer/core/frame/navigator.cc b/third_party/blink/renderer/core/frame/navigator.cc
index fa76e30466faa..7a8dd6481c8f3 100644
--- a/third_party/blink/renderer/core/frame/navigator.cc
+++ b/third_party/blink/renderer/core/frame/navigator.cc
@@ -99,12 +99,7 @@ bool Navigator::cookieEnabled() const {
 }
 
 bool Navigator::webdriver() const {
-  if (RuntimeEnabledFeatures::AutomationControlledEnabled())
-    return true;
-
-  bool automation_enabled = false;
-  probe::ApplyAutomationOverride(GetExecutionContext(), automation_enabled);
-  return automation_enabled;
+  return false;
 }
 
 String Navigator::GetAcceptLanguages() {
diff --git a/third_party/blink/renderer/core/frame/navigator_concurrent_hardware.cc b/third_party/blink/renderer/core/frame/navigator_concurrent_hardware.cc
index f5c0db2d1b58d..ff2a9541212e4 100644
--- a/third_party/blink/renderer/core/frame/navigator_concurrent_hardware.cc
+++ b/third_party/blink/renderer/core/frame/navigator_concurrent_hardware.cc
@@ -4,11 +4,23 @@
 
 #include "third_party/blink/renderer/core/frame/navigator_concurrent_hardware.h"
 
+#include "base/command_line.h"
+#include "base/strings/string_number_conversions.h"
+#include "third_party/blink/public/common/switches.h"
+
 #include "base/system/sys_info.h"
 
 namespace blink {
 
 unsigned NavigatorConcurrentHardware::hardwareConcurrency() const {
+  const auto& cmd = *base::CommandLine::ForCurrentProcess();
+  if (cmd.HasSwitch(blink::switches::kAspectHardwareConcurrency)) {
+    unsigned val = 0;
+    if (base::StringToUint(
+            cmd.GetSwitchValueASCII(blink::switches::kAspectHardwareConcurrency),
+            &val) && val > 0)
+      return val;
+  }
   return static_cast<unsigned>(base::SysInfo::NumberOfProcessors());
 }
 
diff --git a/third_party/blink/renderer/core/frame/navigator_device_memory.cc b/third_party/blink/renderer/core/frame/navigator_device_memory.cc
index 05fa33e4568e8..f27b6b6858e91 100644
--- a/third_party/blink/renderer/core/frame/navigator_device_memory.cc
+++ b/third_party/blink/renderer/core/frame/navigator_device_memory.cc
@@ -4,6 +4,12 @@
 
 #include "third_party/blink/renderer/core/frame/navigator_device_memory.h"
 
+#include <array>
+
+#include "base/command_line.h"
+#include "base/strings/string_number_conversions.h"
+#include "third_party/blink/public/common/switches.h"
+
 #include "third_party/blink/public/common/device_memory/approximated_device_memory.h"
 #include "third_party/blink/public/mojom/use_counter/metrics/web_feature.mojom-shared.h"
 #include "third_party/blink/renderer/core/dom/document.h"
@@ -12,6 +18,20 @@
 namespace blink {
 
 float NavigatorDeviceMemory::deviceMemory() const {
+  const auto& cmd = *base::CommandLine::ForCurrentProcess();
+  if (cmd.HasSwitch(blink::switches::kAspectDeviceMemory)) {
+    double val = 0;
+    if (base::StringToDouble(
+            cmd.GetSwitchValueASCII(blink::switches::kAspectDeviceMemory),
+            &val) && val > 0) {
+      constexpr std::array<float, 6> kAllowed = {0.25f, 0.5f, 1.f, 2.f, 4.f, 8.f};
+      float fval = static_cast<float>(val);
+      for (float v : kAllowed) {
+        if (v == fval)
+          return fval;
+      }
+    }
+  }
   return ApproximatedDeviceMemory::GetApproximatedDeviceMemory();
 }
 
diff --git a/third_party/blink/renderer/core/frame/navigator_id.cc b/third_party/blink/renderer/core/frame/navigator_id.cc
index 50a1727f8dbd5..128f8d1fe5cb1 100644
--- a/third_party/blink/renderer/core/frame/navigator_id.cc
+++ b/third_party/blink/renderer/core/frame/navigator_id.cc
@@ -31,6 +31,9 @@
 
 #include "third_party/blink/renderer/core/frame/navigator_id.h"
 
+#include "base/command_line.h"
+#include "third_party/blink/public/common/switches.h"
+
 #include "base/feature_list.h"
 #include "build/build_config.h"
 #include "third_party/blink/public/common/features.h"
@@ -59,6 +62,9 @@ String NavigatorID::appVersion() {
 }
 
 String NavigatorID::platform() const {
+  const auto& cmd = *base::CommandLine::ForCurrentProcess();
+  if (cmd.HasSwitch(blink::switches::kAspectPlatform))
+    return String(cmd.GetSwitchValueASCII(blink::switches::kAspectPlatform));
 #if BUILDFLAG(IS_MAC)
   // Match Safari and Mozilla on Mac x86.
   return "MacIntel";
-- 
2.39.5

